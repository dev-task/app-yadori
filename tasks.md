# 住まい口コミ SNS 開発タスク

## 完了済みタスク

### REVIEW-1: 基本的なプロジェクト構造と Supabase 接続

-   [x] Vite + React + TypeScript 環境の構築
-   [x] Tailwind CSS の設定
-   [x] Supabase クライアントの設定
-   [x] 基本的なフォルダ構造の作成

### REVIEW-2: 認証システムの実装

-   [x] AuthContext の作成
-   [x] ログイン・新規登録フォームの実装
-   [x] Supabase Auth との連携
-   [x] 認証状態の管理

### REVIEW-3: レビュー投稿機能の実装

-   [x] PostPage コンポーネントの作成
-   [x] フォームバリデーション
-   [x] 画像アップロード機能
-   [x] Supabase Storage との連携
-   [x] レビューデータの保存

### REVIEW-4: レビュー一覧・詳細表示機能

-   [x] ReviewCard コンポーネントの作成
-   [x] HomePage での最新レビュー表示
-   [x] ReviewListPage での検索・フィルター機能
-   [x] ReviewDetailPage での詳細表示
-   [x] ページネーション機能

### REVIEW-5: いいね機能の実装

-   [x] いいねボタンの実装
-   [x] いいね数の表示
-   [x] リアルタイムでのいいね数更新
-   [x] ユーザーごとのいいね状態管理

### REVIEW-6: コメント機能の実装

-   [x] CommentSection コンポーネントの作成
-   [x] コメントの投稿・編集・削除機能
-   [x] リアルタイムでのコメント数更新
-   [x] コメント投稿時の通知機能（トリガー）

### REVIEW-7: プロフィールページの実装

-   [x] ProfilePage コンポーネントの作成
-   [x] ユーザー統計情報の表示
-   [x] プロフィール編集機能
-   [x] ユーザーが投稿したレビュー一覧
-   [x] アカウント設定機能

### REVIEW-8: データベース最適化とマイグレーション修正

-   [x] ユーザープロフィール制約の追加
-   [x] インデックスの最適化
-   [x] RLS ポリシーの改善
-   [x] ユーザー統計ビューの作成
-   [x] SQL 構文エラーの修正

## UI/UX 刷新 & 国際化対応タスク

### UI/UX 刷新タスク (Spotify 風デザイン)

#### UI-1: デザインシステムの定義とダークテーマの導入

-   [x] **Tailwind CSS 設定更新:** `tailwind.config.js`にカラーパレット（ダークテーマ用の黒、グレー、アクセントカラー）、フォント、スペーシングなどのデザイントークンを定義する。
-   [x] **グローバル CSS 修正:** `index.css`で、デフォルトの背景色や文字色をダークテーマに設定する。
-   [x] **レイアウトコンポーネント作成:** アプリ全体のレイアウトの基盤となる`Layout.tsx`を作成・更新し、サイドバーやヘッダーの領域を確保する。

#### UI-2: 主要コンポーネントの再設計

-   [x] **ナビゲーションの再設計:** サイドバーまたはヘッダーを Spotify 風のシンプルで直感的なナビゲーションに更新する。
-   [x] **ReviewCard の再設計:** レビュー一覧で表示される`ReviewCard.tsx`を、画像が際立つモダンなデザインに変更する。ホバーエフェクトを追加する。
-   [x] **ボタン・フォームの再設計:** アプリ全体で使用するボタンや入力フォームのデザインを、定義したカラーパレットに合わせて統一する。

#### UI-3: 主要ページのレイアウト更新

-   [x] **ホームページのレイアウト更新:** グリッドレイアウトを採用し、複数のレビューカードを整然と表示する。
-   [x] **レビュー詳細ページのレイアウト更新:** `ReviewDetailPage`のコンポーネント配置を見直し、情報階層を明確にする。
-   [x] **プロフィールページのレイアウト更新:** `ProfilePage`のデザインを刷新し、統計情報や投稿一覧を見やすくする。
-   [x] **投稿ページのダークモード対応:** `PostPage`をSpotify風ダークテーマに対応させる。

### 国際化(i18n)対応タスク

#### I18N-1: ライブラリ導入と設定

-   [x] **`react-i18next`のインストール:** React Router DOMに適した軽量な国際化ライブラリを導入。
-   [x] **i18n設定ファイルの作成:** `src/i18n/index.ts`でi18nextの設定を行い、言語検出とローカルストレージ保存を実装。
-   [x] **翻訳ファイルの作成:** 日本語(`ja.json`)と英語(`en.json`)の翻訳リソースを作成し、全機能をカバー。
-   [x] **プロバイダの設定:** `I18nProvider`を作成し、アプリケーション全体で翻訳機能を使えるように設定。
-   [x] **言語切り替えコンポーネント:** `LanguageSwitcher`コンポーネントを作成し、ドロップダウンとボタン形式の両方に対応。

#### I18N-2: 静的テキストの多言語対応

-   [x] **主要コンポーネントの翻訳:** ヘッダー、フッター、ナビゲーションなどの共通コンポーネント内の静的テキストを`useI18n`フックを使って多言語化する。
-   [x] **各ページの翻訳:** ホームページ、ログインページ、レビュー投稿ページなどのタイトルやラベルを多言語化する。

#### I18N-3: 動的コンテンツ・設定機能の実装

-   [x] **残りのページの翻訳:** レビュー詳細ページ、検索・フィルターページ、プロフィールページ、コメントシステムの完全多言語化
-   [x] **エラーメッセージの多言語化:** 全てのエラーメッセージとフィードバックメッセージの翻訳対応
-   [x] **日付・時刻表示の多言語化:** 相対時間表示（○分前、○時間前など）の多言語対応
-   [x] **フォームバリデーションの多言語化:** 入力フィールドのバリデーションメッセージの翻訳
-   [x] **動的な値を含む翻訳:** 統計情報や検索結果数など、動的な値を含むテキストの適切な翻訳

## 地図からの住所選択機能タスク

### MAP-1: 地図選択モーダルのUIコンポーネント作成

-   [x] **Mapboxライブラリの導入:** `mapbox-gl`と`@mapbox/mapbox-gl-geocoder`をインストール
-   [x] **環境変数の設定:** Mapbox APIキーを`.env`ファイルに追加
-   [x] **地図モーダルコンポーネントの作成:** `MapModal.tsx`を作成し、基本的なモーダル構造を実装
-   [x] **「地図で選択」ボタンの追加:** 投稿フォームに地図モーダルを開くボタンを追加

### MAP-2: モーダル内への地図表示

-   [x] **Mapboxマップコンポーネントの作成:** `MapboxMap.tsx`を作成し、地図の初期化と表示を実装
-   [x] **ピンコンポーネントの作成:** ドラッグ可能なピンを地図上に表示する機能を実装
-   [x] **地図の初期設定:** 東京駅を中心とした初期表示位置の設定
-   [x] **レスポンシブ対応:** モバイルデバイスでの地図表示最適化
-   [x] **エラーハンドリング:** APIキー未設定時や地図読み込み失敗時の適切なエラー表示
-   [x] **ユーザビリティ改善:** ピンのホバーエフェクト、ドラッグ時の視覚的フィードバック
-   [x] **現在地取得機能:** ユーザーの現在地を取得して地図に表示する機能

### MAP-3: 住所検索機能（ジオコーディング）の実装

-   [x] **ジオコーディングユーティリティの作成:** `src/utils/geocoding.ts`を作成し、Mapbox Geocoding APIを呼び出すユーティリティ関数を実装
-   [x] **住所検索バーの強化:** `AddressSearchBar.tsx`を改良し、高度な検索機能とキーボードナビゲーションを実装
-   [x] **検索結果の処理:** 検索結果から座標を取得し、地図とピンを移動させる機能を実装
-   [x] **検索候補の表示:** 入力に応じた住所候補をドロップダウンで表示、カテゴリ別アイコン対応
-   [x] **デバウンス処理:** API呼び出しの最適化のため、検索入力にデバウンス処理を追加
-   [x] **エラーハンドリング:** 検索失敗時の適切なエラー表示とフォールバック処理
-   [x] **住所バリデーション:** 入力された住所の妥当性チェック機能
-   [x] **検索結果の分類:** 駅、住所、スポットなどのカテゴリ別表示
-   [x] **キーボードナビゲーション:** 矢印キーとEnterキーによる検索結果選択

### MAP-4: 住所の自動入力機能（リバースジオコーディング）の実装

-   [x] **リバースジオコーディングAPIクライアントの強化:** 座標から住所を取得するユーティリティ関数を高精度化
-   [x] **ピン移動時の住所取得:** ピンがドラッグされた際に自動的に住所を取得する機能を実装
-   [x] **住所フォーマット処理:** 取得した住所データを日本語形式で適切にフォーマット
-   [x] **確定ボタンの実装:** 選択した位置と住所を親フォームに送信する機能を実装
-   [x] **エラーハンドリング:** API呼び出し失敗時の適切なエラー表示とフォールバック処理
-   [x] **住所品質評価システム:** 取得した住所の信頼度と品質を評価し、ユーザーに表示
-   [x] **デバウンス処理とキャッシュ:** 不要なAPI呼び出しを防ぐためのキャッシュ機能
-   [x] **フォールバック機能:** 住所取得失敗時の段階的フォールバック処理
-   [x] **住所正規化:** 取得した住所の統一形式への変換機能

### MAP-5: 統合とテスト

-   [x] **投稿フォームとの統合:** 地図で選択した住所と座標をレビュー投稿フォームに正しく反映
-   [x] **バリデーション追加:** 地図で選択された住所の妥当性チェック
-   [x] **ユーザビリティ改善:** 地図操作のガイダンスとヘルプテキストの追加
-   [x] **パフォーマンス最適化:** 地図ライブラリの遅延読み込みとメモリ使用量の最適化
-   [x] **多言語対応:** 地図関連のUIテキストの国際化対応
-   [x] **品質インジケーター:** 住所の精度を視覚的に表示するバッジシステム
-   [x] **エラー回復機能:** ネットワークエラーや API制限時の適切な処理

## レビュー編集機能タスク

### EDIT-1: レビュー編集機能の実装

-   [x] **編集権限の確認:** レビューの投稿者のみが編集できるように権限チェックを実装
-   [x] **編集モードの実装:** レビュー詳細ページに編集ボタンと編集モードの切り替え機能を追加
-   [x] **フォーム状態管理:** 編集時のフォームデータ管理と元データへのリセット機能
-   [x] **画像編集機能:** 既存画像の削除、新規画像の追加、画像の管理機能
-   [x] **地図連携:** 編集モードでも地図からの住所選択機能を利用可能
-   [x] **バリデーション:** 編集時のデータ検証とエラーハンドリング
-   [x] **保存機能:** 編集内容をデータベースに保存し、画像の追加・削除を処理
-   [x] **UI/UX改善:** 編集中の視覚的フィードバックと操作性の向上
-   [x] **多言語対応:** 編集機能関連のテキストの国際化対応

## 技術スタック

-   **フロントエンド**: React 18, TypeScript, Tailwind CSS
-   **バックエンド**: Supabase (PostgreSQL, Auth, Storage)
-   **ルーティング**: React Router DOM
-   **アイコン**: Lucide React
-   **ビルドツール**: Vite
-   **国際化**: React i18next
-   **地図**: Mapbox GL JS, Mapbox Geocoding API

## データベース構造

-   **users**: ユーザープロフィール情報
-   **reviews**: レビュー投稿データ（latitude, longitude フィールド含む）
-   **review_images**: レビュー画像
-   **comments**: コメントデータ
-   **likes**: いいね情報
-   **chat_histories**: チャット履歴（将来の拡張用）

## 主要機能

1. ユーザー認証（登録・ログイン）
2. レビュー投稿（画像アップロード・地図選択対応）
3. レビュー編集（投稿者のみ）
4. レビュー検索・フィルタリング
5. いいね機能
6. コメント機能
7. プロフィール管理
8. レスポンシブデザイン
9. 多言語対応（日本語・英語）
10. 地図からの住所選択機能

## 今後の拡張予定

-   リアルタイム通知機能
-   レビューの地図表示機能
-   レビューの詳細検索（位置ベース）
-   ユーザーフォロー機能
-   レビューの共有機能